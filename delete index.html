<!doctype html>
<html lang="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>V√¶r ‚Äì √Ölesund</title>

<style>
html, body {
  margin: 0;
  height: 100%;
  background: transparent;
  overflow: hidden;
  font-family: Arial, Helvetica, sans-serif;
  color: #ffffff;
}

/* Sidepanel ‚Äì fyller regionen i Xibo */
.panel {
  height: 100%;
  box-sizing: border-box;
  padding: 16px;
  background: rgba(0,0,0,0.25);
  border-radius: 14px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
}

.top {
  display: flex;
  align-items: center;
  gap: 12px;
}

.icon {
  font-size: 54px;
  line-height: 1;
}

.temp {
  font-size: 46px;
  font-weight: bold;
  line-height: 1;
}

.desc {
  font-size: 15px;
  opacity: 0.95;
  margin-top: 4px;
}

.meta {
  font-size: 14px;
  opacity: 0.9;
  line-height: 1.4;
}

.place {
  font-size: 13px;
  opacity: 0.75;
}
</style>
</head>

<body>
<div class="panel">
  <div class="top">
    <div class="icon" id="icon">‚õÖ</div>
    <div>
      <div class="temp" id="temp">--¬∞C</div>
      <div class="desc" id="desc">Laster v√¶r‚Ä¶</div>
    </div>
  </div>

  <div class="meta" id="meta">
    Vind: -- m/s<br>
    Nedb√∏r i dag: -- mm
  </div>

  <div class="place">√Ölesund</div>
</div>

<script>
(function () {
  var LAT = 62.4722;
  var LON = 6.1495;

  function el(id){ return document.getElementById(id); }

  function iconText(code, isDay){
    if (code === 0) return [isDay ? "‚òÄÔ∏è" : "üåô", "Klart"];
    if (code === 1) return [isDay ? "üå§Ô∏è" : "üåô‚òÅÔ∏è", "Lett skyet"];
    if (code === 2) return ["‚õÖ", "Delvis skyet"];
    if (code === 3) return ["‚òÅÔ∏è", "Overskyet"];
    if (code === 45 || code === 48) return ["üå´Ô∏è", "T√•ke"];
    if (code >= 51 && code <= 67) return ["üåßÔ∏è", "Regn"];
    if (code >= 71 && code <= 77) return ["‚ùÑÔ∏è", "Sn√∏"];
    if (code >= 80 && code <= 82) return ["üåßÔ∏è", "Byger"];
    if (code >= 95) return ["‚õàÔ∏è", "Tordenv√¶r"];
    return ["‚õÖ", "V√¶r"];
  }

  function todayIndex(times){
    var d = new Date();
    var t = d.getFullYear() + "-" +
            ("0"+(d.getMonth()+1)).slice(-2) + "-" +
            ("0"+d.getDate()).slice(-2);
    for (var i=0;i<times.length;i++){
      if (times[i] === t) return i;
    }
    return 0;
  }

  function loadWeather(){
    var url =
      "https://api.open-meteo.com/v1/forecast" +
      "?latitude=" + LAT +
      "&longitude=" + LON +
      "&current_weather=true" +
      "&daily=precipitation_sum" +
      "&timezone=Europe%2FOslo";

    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.onreadystatechange = function(){
      if (xhr.readyState !== 4) return;
      if (xhr.status !== 200) {
        el("desc").textContent = "Ingen data";
        return;
      }

      try {
        var data = JSON.parse(xhr.responseText);
        var cw = data.current_weather;

        var it = iconText(cw.weathercode, cw.is_day === 1);
        el("icon").textContent = it[0];
        el("temp").textContent = Math.round(cw.temperature) + "¬∞C";
        el("desc").textContent = it[1];

        var wind = Math.round(cw.windspeed);

        var precip = "--";
        if (data.daily && data.daily.precipitation_sum) {
          var i = todayIndex(data.daily.time);
          precip = Math.round(data.daily.precipitation_sum[i] * 10) / 10;
        }

        el("meta").innerHTML =
          "Vind: " + wind + " m/s<br>" +
          "Nedb√∏r i dag: " + precip + " mm";

      } catch (e) {
        el("desc").textContent = "Datafeil";
      }
    };
    xhr.send();
  }

  loadWeather();
  setInterval(loadWeather, 600000); // 10 min
})();
</script>
</body>
</html>

